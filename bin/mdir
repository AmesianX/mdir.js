#!/bin/bash

realpath() {
  OURPWD=$PWD
  cd "$(dirname "$1")"
  LINK=$(readlink "$(basename "$1")")
  while [ "$LINK" ]; do
    cd "$(dirname "$LINK")"
    LINK=$(readlink "$(basename "$1")")
  done
  REALPATH="$PWD/$(basename "$1")"
  cd "$OURPWD"
  echo "$REALPATH"
}

MDIR_PWD_FILE="${HOME}/.m/path"

echo "/usr/bin/env node `realpath $BASH_SOURCE`.js "$@""
/usr/bin/env node `realpath $BASH_SOURCE`.js "$@"

if test -r "$MDIR_PWD_FILE"; then
    MDIR_PWD="`cat $MDIR_PWD_FILE`"

    if test -n "$MDIR_PWD" && test -d "$MDIR_PWD"; then
        cd "$MDIR_PWD"
    fi
    unset MDIR_PWD
fi

unset MDIR_PWD_FILE
